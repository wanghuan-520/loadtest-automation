# GodGPT 接口性能测试计划

## 1. 测试概述

### 测试目标
1. **性能阈值测试**：确定加压多少时性能恶化明显
2. **QPS容量测试**：测试最大QPS（1分钟加到N个并发，持续5分钟，逐渐增加QPS，持续5分钟）
3. **真实AI模式压测**：使用AI模式真实压测（当前chat是mock，期望使用真实模型压一轮，确认chat请求是否恶化严重）

### 测试环境
- **环境配置**：固定两个pod

### 接口优先级分布
- **P0**：4个接口（完成一轮，待优化后，进行第二轮压测）
- **P1**：13个接口
- **P2**：19个接口
- **P3**：3个接口（不需要压测）

## 2. 接口测试清单

### 2.1 核心聊天功能（P0优先级）

#### 访客聊天功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 进展状态 |
|------|----------|----------|----------|--------|----------|
| 创建访客会话 | POST | `/api/godgpt/guest/create-session` | 创建访客会话 | P0 | 一轮完成，待优化 |
| 访客聊天 | POST | `/api/godgpt/guest/chat` | 访客聊天接口 | P0 | 一轮完成，待优化 |

#### 登录用户聊天功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 进展状态 |
|------|----------|----------|----------|--------|----------|
| 创建会话 | POST | `/api/godgpt/create-session` | 登录后创建会话 | P0 | 一轮完成，待优化 |
| 用户聊天 | POST | `/api/gotgpt/chat` | 登录后聊天接口 | P0 | 一轮完成，待优化 |

### 2.2 会话管理功能

#### P1优先级接口
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取会话信息 | GET | `/api/godgpt/session-info/{sessionId}` | 获取会话信息 | P1 | |
| 会话列表 | GET | `/api/godgpt/session-list` | 获取会话列表 | P1 | |

#### P2优先级接口
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取分享记录 | GET | `/api/godgpt/share/{shareId}` | 获取分享的聊天记录 | P2 | |
| 删除会话 | DELETE | `/api/godgpt/chat/{sessionId}` | 删除会话 | P2 | |
| 会话重命名 | POST | `/api/godgpt/chat/rename` | 会话列表重命名 | P2 | |

### 2.3 特殊功能模块

#### 命理功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 更新用户信息 | PUT | `/api/godgpt/account` | 更新用户信息 | P1 | |
| 创建命理会话 | POST | `/api/godgpt/create-session` | 创建命理会话 | P1 | 同文字会话，无需重复压测 |
| 命理聊天 | POST | `/api/gotgpt/chat` | 命理会话 | P1 | 同文字会话，无需重复压测 |

#### 灵魂控制台
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 创建灵魂会话 | POST | `/api/godgpt/create-session` | 创建灵魂控制台会话 | P1 | 同文字会话，无需重复压测 |
| 灵魂对话 | POST | `/api/gotgpt/chat` | 灵魂对话会话 | P1 | 同文字会话，无需重复压测 |

#### 音频功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 语音聊天 | POST | `/api/godgpt/voice/chat` | 语音聊天接口 | P1 | |

#### 图片功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 检查图片上传权限 | GET | `/api/godgpt/can-upload-image` | 判断是否可以上传图片 | P2 | |
| 上传图片 | POST | `/api/godgpt/blob` | 上传图片 | P2 | |
| 图片会话 | POST | `/api/gotgpt/chat` | 图片会话 | P2 | |

### 2.4 用户认证与管理

#### 认证功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 检查邮箱注册 | POST | `/api/account/check-email-registered` | 检查邮箱是否已注册 | P2 | |
| 邮箱登录 | POST | `/connect/token` | 邮箱密码登录 | P2 | |
| 发送验证码 | POST | `/api/account/send-register-code` | 发送验证码(mock下验证码逻辑) | P2 | |
| 邮箱注册 | POST | `/api/account/godgpt-register` | 邮箱注册 | P2 | |
| 谷歌登录 | POST | `/connect/token` | 谷歌账号登录 | P1 | |

> **注意**：苹果账号注册因IP无法重复使用，无法进行压测

#### 用户信息管理
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取用户信息 | GET | `/api/godgpt/account` | 获取用户信息 | P1 | |
| 更新用户信息 | PUT | `/api/godgpt/account` | 更新用户信息 | P2 | |
| 获取用户档案 | GET | `/api/profile/user-info` | 获取用户档案信息 | P1 | |
| 获取用户ID | GET | `/api/query/user-id` | 获取用户ID | P1 | |
| 用户登出 | GET | `/api/account/logout` | 用户登出 | P2 | |

### 2.5 支付系统
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取支付记录 | GET | `/api/godgpt/payment/list` | 获取支付记录 | P1 | |
| 检查Apple订阅 | GET | `/api/godgpt/payment/has-apple-subscription` | 检查Apple订阅 | P1 | |
| 获取产品列表 | GET | `/api/godgpt/payment/products` | 获取产品列表 | P1 | |
| 验证收据 | POST | `/api/godgpt/payment/verify-receipt` | 验证收据(IAP) | P2 | |
| 创建结账会话 | POST | `/api/godgpt/payment/create-checkout-session` | 创建结账会话(Stripe) | P2 | |
| 取消订阅 | POST | `/api/godgpt/payment/cancel-subscription` | 取消支付订阅 | P2 | |

### 2.6 邀请系统
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取邀请信息 | GET | `/api/godgpt/invitation/info` | 获取邀请信息 | P2 | |
| 兑换邀请码 | POST | `/api/godgpt/invitation/redeem` | 兑换邀请码 | P1 | |
| 积分历史 | GET | `/api/godgpt/invitation/credits/history` | 获取积分历史 | P2 | |

### 2.7 其他功能
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取分享关键词 | GET | `/api/godgpt/share/keyword` | 获取分享关键词 | P2 | |
| 积分提示 | POST | `/api/godgpt/account/show-toast` | 显示积分提示 | P1 | |
| 版本检查 | GET | `/api/godgpt/query-version` | 检查应用版本 | P3 | 查配置，没有业务逻辑 |

### 2.8 系统管理（P3优先级，后续废弃）
| 功能 | HTTP方法 | 接口路径 | 接口描述 | 优先级 | 备注 |
|------|----------|----------|----------|--------|------|
| 获取系统提示词 | GET | `/api/godgpt/configuration/system-prompt` | 获取系统提示词 | P3 | 后续会废弃，不需要压测 |
| 更新系统提示词 | POST | `/api/godgpt/configuration/system-prompt` | 更新系统提示词 | P3 | 后续会废弃，不需要压测 |

## 3. 测试执行计划

### 第一阶段：P0接口压测
- 重点测试4个核心接口
- 完成性能基线测试
- 识别性能瓶颈点

### 第二阶段：P1接口压测  
- 测试13个重要接口
- 验证系统整体负载能力

### 第三阶段：P2接口补充测试
- 测试19个辅助功能接口
- 完善整体性能画像

### 备注
- P3接口暂不进行压测
- 重复功能接口（如命理、灵魂控制台的会话创建）可复用核心接口的测试结果 