# QPS å›ºå®šæµ‹è¯•å¥—ä»¶

è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«äº†æ‰€æœ‰å›ºå®šQPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰çš„å‹åŠ›æµ‹è¯•è„šæœ¬ï¼Œä½¿ç”¨`constant-arrival-rate`æ‰§è¡Œå™¨ç¡®ä¿æ’å®šçš„è¯·æ±‚é€Ÿç‡ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
qps/
â”œâ”€â”€ README.md                                      # æœ¬è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ run-all-qps-tests.sh                          # è¿è¡Œæ‰€æœ‰QPSæµ‹è¯•çš„ä¸»è„šæœ¬
â”œâ”€â”€ run-guest-create-session-qps-test.sh          # Gueståˆ›å»ºä¼šè¯å•ç‹¬è¿è¡Œè„šæœ¬
â”œâ”€â”€ guest-create-session-fixed-qps-test.js        # Gueståˆ›å»ºä¼šè¯QPSæµ‹è¯•
â”œâ”€â”€ guest-chat-fixed-qps-test.js                  # GuestèŠå¤©QPSæµ‹è¯•
â”œâ”€â”€ user-create-session-fixed-qps-test.js         # Useråˆ›å»ºä¼šè¯QPSæµ‹è¯•
â””â”€â”€ user-chat-fixed-qps-test.js                   # UserèŠå¤©QPSæµ‹è¯•
```

## ğŸ¯ æµ‹è¯•è„šæœ¬æ¦‚è§ˆ

| è„šæœ¬åç§° | é»˜è®¤QPS | æµ‹è¯•å¯¹è±¡ | æè¿° |
|---------|---------|----------|------|
| `guest-create-session-fixed-qps-test.js` | 50 | è®¿å®¢åˆ›å»ºä¼šè¯ | æµ‹è¯•è®¿å®¢ç”¨æˆ·ä¼šè¯åˆ›å»ºæ€§èƒ½ |
| `guest-chat-fixed-qps-test.js` | 30 | è®¿å®¢èŠå¤© | æµ‹è¯•è®¿å®¢ç”¨æˆ·èŠå¤©å“åº”æ€§èƒ½ |
| `user-create-session-fixed-qps-test.js` | 40 | å·²ç™»å½•ç”¨æˆ·åˆ›å»ºä¼šè¯ | æµ‹è¯•å·²ç™»å½•ç”¨æˆ·ä¼šè¯åˆ›å»ºæ€§èƒ½ |
| `user-chat-fixed-qps-test.js` | 20 | å·²ç™»å½•ç”¨æˆ·èŠå¤© | æµ‹è¯•å·²ç™»å½•ç”¨æˆ·èŠå¤©å“åº”æ€§èƒ½ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰QPSæµ‹è¯•

```bash
# ä½¿ç”¨é»˜è®¤QPSè¿è¡Œæ‰€æœ‰æµ‹è¯•
./run-all-qps-tests.sh

# ä½¿ç”¨è‡ªå®šä¹‰QPSè¿è¡Œæ‰€æœ‰æµ‹è¯•
./run-all-qps-tests.sh 25

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./run-all-qps-tests.sh -h
```

### è¿è¡Œå•ä¸ªQPSæµ‹è¯•

```bash
# Gueståˆ›å»ºä¼šè¯æµ‹è¯•ï¼ˆæ¨èä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼‰
./run-guest-create-session-qps-test.sh 50

# ç›´æ¥è¿è¡Œå…¶ä»–æµ‹è¯•
k6 run -e TARGET_QPS=30 guest-chat-fixed-qps-test.js
k6 run -e TARGET_QPS=40 user-create-session-fixed-qps-test.js
k6 run -e TARGET_QPS=20 user-chat-fixed-qps-test.js
```

## âš™ï¸ QPSæµ‹è¯•ç‰¹æ€§

### æ ¸å¿ƒä¼˜åŠ¿
- **ç²¾ç¡®QPSæ§åˆ¶**: ä½¿ç”¨`constant-arrival-rate`ç¡®ä¿æ’å®šè¯·æ±‚é€Ÿç‡
- **æ™ºèƒ½VUç®¡ç†**: æ ¹æ®å“åº”æ—¶é—´è‡ªåŠ¨è°ƒæ•´è™šæ‹Ÿç”¨æˆ·æ•°é‡
- **èµ„æºä¿æŠ¤**: maxVUsé™åˆ¶é˜²æ­¢èµ„æºè¿‡åº¦æ¶ˆè€—
- **å³æ—¶æ¸…ç†**: æµ‹è¯•ç»“æŸåVUè‡ªåŠ¨å½’é›¶

### é…ç½®å‚æ•°
- **executor**: `constant-arrival-rate`
- **duration**: 5åˆ†é’Ÿ
- **rate**: å¯é€šè¿‡`TARGET_QPS`ç¯å¢ƒå˜é‡è‡ªå®šä¹‰
- **preAllocatedVUs**: `Math.max(TARGET_QPS, 1)`
- **maxVUs**: `TARGET_QPS * 2` æˆ– `TARGET_QPS * 3`ï¼ˆèŠå¤©æµ‹è¯•ï¼‰

## ğŸ“Š æ€§èƒ½é˜ˆå€¼

### é€šç”¨é˜ˆå€¼
- HTTPè¯·æ±‚å¤±è´¥ç‡ < 1%
- APIè°ƒç”¨æˆåŠŸç‡ > 99%

### å…·ä½“é˜ˆå€¼
- **åˆ›å»ºä¼šè¯**: P95å“åº”æ—¶é—´ < 2000ms
- **èŠå¤©å“åº”**: P95å“åº”æ—¶é—´ < 3000-5000ms

## ğŸ” å…³é”®æŒ‡æ ‡

è¿è¡Œæµ‹è¯•åï¼Œé‡ç‚¹å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š

1. **QPSç¨³å®šæ€§**: å®é™…QPSåº”æ¥è¿‘ç›®æ ‡QPS
2. **APIè°ƒç”¨æˆåŠŸç‡**: åº”ä¿æŒåœ¨99%ä»¥ä¸Š
3. **å“åº”æ—¶é—´åˆ†å¸ƒ**: é‡ç‚¹å…³æ³¨P95å’ŒP99
4. **VUä½¿ç”¨æƒ…å†µ**: è§‚å¯ŸVUæ•°é‡çš„åŠ¨æ€è°ƒæ•´
5. **ç³»ç»Ÿèµ„æº**: CPUã€å†…å­˜ã€ç½‘ç»œIOä½¿ç”¨æƒ…å†µ

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### QPSé€‰æ‹©å»ºè®®
- **ä½è´Ÿè½½æµ‹è¯•**: 5-20 QPS
- **ä¸­ç­‰è´Ÿè½½æµ‹è¯•**: 20-50 QPS  
- **é«˜è´Ÿè½½æµ‹è¯•**: 50-100 QPS
- **æé™æµ‹è¯•**: 100+ QPS

### æµ‹è¯•é¡ºåºå»ºè®®
1. å…ˆè¿è¡Œå•ä¸ªæ¥å£æµ‹è¯•ç¡®è®¤åŸºæœ¬åŠŸèƒ½
2. é€æ­¥å¢åŠ QPSæ‰¾åˆ°æ€§èƒ½æ‹ç‚¹
3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶è¿›è¡Œç»¼åˆè¯„ä¼°

### æ•…éšœæ’æŸ¥
- å¦‚æœQPSæ— æ³•è¾¾åˆ°ç›®æ ‡ï¼Œæ£€æŸ¥maxVUsè®¾ç½®
- å¦‚æœå“åº”æ—¶é—´è¿‡é•¿ï¼Œè€ƒè™‘é™ä½ç›®æ ‡QPS
- å¦‚æœæˆåŠŸç‡ä½äºé˜ˆå€¼ï¼Œæ£€æŸ¥æœåŠ¡ç«¯æ€§èƒ½

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [k6 constant-arrival-rate æ–‡æ¡£](https://k6.io/docs/using-k6/scenarios/executors/constant-arrival-rate/)
- [../README.md](../README.md) - å‹åŠ›æµ‹è¯•ä¸»æ–‡æ¡£
- [../../config/](../../config/) - é…ç½®æ–‡ä»¶è¯´æ˜ 